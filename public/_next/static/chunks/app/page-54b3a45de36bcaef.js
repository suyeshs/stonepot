(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3966:(e,t,s)=>{Promise.resolve().then(s.bind(s,5753))},5753:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i});var r=s(5155),n=s(2115);class a{async connect(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"auto",t=arguments.length>1?arguments[1]:void 0;return new Promise((s,r)=>{try{console.log("[VertexAILive] Connecting to:",this.wsUrl),this.ws=new WebSocket(this.wsUrl),this.ws.onopen=()=>{console.log("[VertexAILive] WebSocket connected"),this.isConnected=!0,this.sendMessage({type:"start_session",config:{language:e,userId:t,systemInstruction:null}})},this.ws.onmessage=e=>{if(e.data instanceof ArrayBuffer||e.data instanceof Blob){let t=e.data instanceof ArrayBuffer?e.data.byteLength:e.data.size;console.log("[VertexAILive] Received audio:",t,"bytes"),e.data instanceof Blob?e.data.arrayBuffer().then(e=>{this.audioCallback&&this.audioCallback(e)}):this.audioCallback&&this.audioCallback(e.data);return}try{let t=JSON.parse(e.data);console.log("[VertexAILive] Received message:",t.type),"session_started"===t.type&&(this.sessionId=t.sessionId,console.log("[VertexAILive] Session started:",this.sessionId),s()),"session_ready"===t.type&&console.log("[VertexAILive] Session ready (Vertex AI connected)"),"error"===t.type&&(console.error("[VertexAILive] Error from server:",t.error),this.errorCallback&&this.errorCallback(t.error)),this.messageCallback&&this.messageCallback(t)}catch(t){console.warn("[VertexAILive] Non-JSON message:",e.data)}},this.ws.onerror=e=>{console.error("[VertexAILive] WebSocket error:",e),this.errorCallback&&this.errorCallback("WebSocket connection error"),r(Error("WebSocket connection failed"))},this.ws.onclose=e=>{console.log("[VertexAILive] WebSocket closed:",e.code,e.reason),this.isConnected=!1,this.sessionId=null},setTimeout(()=>{this.sessionId||r(Error("Session start timeout"))},1e4)}catch(e){console.error("[VertexAILive] Connection error:",e),r(e)}})}sendAudio(e){if(!this.isConnected||!this.ws)return void console.warn("[VertexAILive] Cannot send audio - not connected");this.ws.readyState===WebSocket.OPEN?(this.ws.send(e),console.log("[VertexAILive] Sent audio:",e.byteLength,"bytes")):console.warn("[VertexAILive] WebSocket not open, readyState:",this.ws.readyState)}sendMessage(e){this.ws&&this.ws.readyState===WebSocket.OPEN&&(this.ws.send(JSON.stringify(e)),console.log("[VertexAILive] Sent message:",e.type))}sendTurnComplete(){this.sendMessage({type:"turn_complete"})}onAudio(e){this.audioCallback=e}onMessage(e){this.messageCallback=e}onError(e){this.errorCallback=e}disconnect(){this.ws&&(this.sendMessage({type:"end_session"}),setTimeout(()=>{this.ws&&(this.ws.close(),this.ws=null)},500)),this.isConnected=!1,this.sessionId=null}isActive(){return this.isConnected&&null!==this.ws&&this.ws.readyState===WebSocket.OPEN}getSessionId(){return this.sessionId}constructor(e){if(this.ws=null,this.sessionId=null,this.isConnected=!1,this.audioCallback=null,this.messageCallback=null,this.errorCallback=null,e)this.wsUrl=e;else{let e="https:"===window.location.protocol?"wss:":"ws:",t=window.location.host;this.wsUrl="".concat(e,"//").concat(t,"/api/vertex-ai-live")}}}let o=e=>{let{audioLevels:t,sessionStatus:s}=e,a=(0,n.useMemo)(()=>{let e=[],r=Math.ceil(t.length/8);for(let n=0;n<8;n++){let a=n*r,o=Math.min(a+r,t.length),i=0;if(t.length>0){let e=t.slice(a,o);i=e.reduce((e,t)=>e+t,0)/e.length}else i="thinking"===s?.15+.1*Math.sin(Date.now()/400+.5*n):"listening"===s?.2+.05*n:.1;e.push({index:n,level:i,baseRadius:12+9*n})}return e},[t,s]),o=(e,t)=>"thinking"===s?"hsla(".concat(30+e/8*30,", 80%, 60%, ").concat(.4+.6*t,")"):"hsla(".concat(180+e/8*60,", 70%, 60%, ").concat(.4+.6*t,")");return(0,r.jsx)("div",{className:"px-6 py-6",children:(0,r.jsx)("div",{className:"relative flex items-center justify-center",children:(0,r.jsxs)("div",{className:"relative w-80 h-80",children:[(0,r.jsx)("div",{className:"absolute inset-0 rounded-full blur-xl transition-colors duration-500 ".concat("thinking"===s?"bg-gradient-to-r from-orange-500/20 to-amber-500/20":"bg-gradient-to-r from-cyan-500/20 to-blue-500/20")}),(0,r.jsx)("svg",{className:"relative w-full h-full",viewBox:"0 0 200 200",style:{willChange:"transform"},children:a.map(e=>{let t=12*e.level,s=e.baseRadius+t,n=2+4*e.level,a=o(e.index,e.level);return(0,r.jsx)("circle",{cx:"100",cy:"100",r:s,fill:"none",stroke:a,strokeWidth:n,style:{filter:"drop-shadow(0 0 ".concat(4+8*e.level,"px ").concat(a,")"),transition:"all 75ms ease-out"}},e.index)})})]})})})};function i(){let[e,t]=(0,n.useState)(!1),[s,i]=(0,n.useState)("idle"),[l,c]=(0,n.useState)("auto"),[d,u]=(0,n.useState)("offline"),[h,x]=(0,n.useState)(Array(32).fill(0)),[m,g]=(0,n.useState)(0),f=(0,n.useRef)(null),b=(0,n.useRef)(null),p=(0,n.useRef)(null),v=(0,n.useRef)(0),y=(0,n.useRef)(!1),w=(0,n.useRef)(0),A=(0,n.useRef)(null),k=(0,n.useRef)(null),S=(0,n.useRef)(null),I=(0,n.useRef)(0),N=(0,n.useRef)(null),C=(0,n.useRef)(0);(0,n.useEffect)(()=>{let e=async()=>{try{(await fetch("/health")).ok?u("online"):u("offline")}catch(e){u("offline")}};e();let t=setInterval(e,3e4);return()=>clearInterval(t)},[]),(0,n.useEffect)(()=>{if(e){C.current=Date.now(),g(0);let e=setInterval(()=>{g(Math.floor((Date.now()-C.current)/1e3))},1e3);return()=>clearInterval(e)}g(0),C.current=0},[e]);let j=()=>{if(S.current)return;let e=0,t=()=>{e+=.05,x(Array.from({length:32},(t,s)=>Math.abs(.15*Math.sin(e+.5*s)+.1*Math.sin(1.3*e-.3*s)))),S.current=requestAnimationFrame(t)};t()},L=()=>{S.current&&(cancelAnimationFrame(S.current),S.current=null)},V=async()=>{try{let e;console.log("[VertexAILive] Starting session..."),i("listening"),console.log("[VertexAILive] Requesting microphone permission..."),await M(),console.log("[VertexAILive] Microphone access granted"),f.current=new a,f.current.onAudio(async e=>{let t=performance.now(),s=w.current>0?t-w.current:0;console.log("[VertexAILive] \uD83D\uDD0A Audio response received"),console.log("[Timing] Total latency: ".concat(s.toFixed(0),"ms")),await R(e)}),f.current.onMessage(e=>{console.log("[VertexAILive] Message:",e.type),"session_ready"===e.type&&i("listening")});let s=((e=localStorage.getItem("vaakya_user_id"))?console.log("[Context] Existing user ID loaded:",e):(e="user_".concat(Date.now(),"_").concat(Math.random().toString(36).substring(2,15)),localStorage.setItem("vaakya_user_id",e),console.log("[Context] New user ID created:",e)),e);await f.current.connect(l,s),console.log("[VertexAILive] Connected successfully with userId:",s),console.log("[VertexAILive] Setting session active..."),t(!0),console.log("[VertexAILive] Session active state set to TRUE"),console.log("[VertexAILive] Starting idle animation..."),j(),console.log("[VertexAILive] ✅ Session started successfully")}catch(e){console.error("[VertexAILive] ❌ Failed:",e),alert("Failed to start session: "+e.message),i("idle"),t(!1)}},M=async()=>{let e=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:16e3,channelCount:1,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}}),t=new AudioContext({sampleRate:16e3});b.current=t,await t.audioWorklet.addModule("/audio-processor.js");let s=t.createMediaStreamSource(e),r=new AudioWorkletNode(t,"audio-stream-processor"),n=0;r.port.onmessage=e=>{let{type:t,data:s,rms:r,duration:a}=e.data;if("speech-start"===t)w.current=performance.now(),i("listening"),L(),console.log("[Timing] \uD83C\uDFA4 Speech detected (RMS: ".concat(r.toFixed(4),")"));else if("speech-end"===t)I.current=performance.now(),i("thinking"),console.log("[Timing] ✋ Speech ended after ".concat(a.toFixed(0),"ms")),x(Array(32).fill(0));else if("audio-data"===t){var o;if(!(null==(o=f.current)?void 0:o.isActive()))return;f.current.sendAudio(s),++n%50==0&&console.log("[Audio] \uD83D\uDCE4 Sent",n,"chunks")}},s.connect(r),r.connect(t.destination),i("listening"),console.log("[VertexAILive] ✅ AudioWorklet streaming started")},F=()=>{if(!A.current)return;let e=A.current,t=e.frequencyBinCount,s=new Uint8Array(t),r=()=>{e.getByteFrequencyData(s);let n=Math.floor(t/32),a=[];for(let e=0;e<32;e++){let t=e*n,r=t+n,o=0;for(let e=t;e<r;e++)o+=s[e];let i=Math.min(o/n/255*3,1);a.push(i)}x(a),k.current=requestAnimationFrame(r)};r()},R=async e=>{try{p.current||(p.current=new AudioContext({sampleRate:24e3}),v.current=p.current.currentTime,A.current=p.current.createAnalyser(),A.current.fftSize=256,A.current.connect(p.current.destination));let t=p.current,s=new Int16Array(e),r=new Float32Array(s.length);for(let e=0;e<s.length;e++)r[e]=s[e]/(s[e]<0?32768:32767);let n=t.createBuffer(1,r.length,24e3);n.getChannelData(0).set(r);let a=t.createBufferSource();a.buffer=n,A.current?a.connect(A.current):a.connect(t.destination);let o=t.currentTime;v.current>0&&o>v.current+.1&&(console.warn("[Audio] Gap detected:",(o-v.current).toFixed(3),"s - resetting timeline"),v.current=o);let l=Math.max(o,v.current);a.start(l);let c=n.duration;if(v.current=l+c,console.log("[Audio] Chunk scheduled - currentTime:",o.toFixed(3),"startTime:",l.toFixed(3),"duration:",c.toFixed(3),"nextPlayTime:",v.current.toFixed(3)),!y.current){y.current=!0,i("speaking"),F();let e=performance.now(),t=w.current>0?e-w.current:0;console.log("[Timing] \uD83D\uDD0A Audio playback started"),console.log("[Timing] ⚡ Total latency: ".concat(t.toFixed(0),"ms"))}N.current&&(clearTimeout(N.current),N.current=null);let d=(l+c-t.currentTime)*1e3+200;N.current=setTimeout(()=>{t.currentTime>=v.current-.05&&(y.current=!1,i("listening"),k.current&&(cancelAnimationFrame(k.current),k.current=null),j(),console.log("[VertexAILive] Audio playback ended"))},Math.max(d,0))}catch(e){console.error("[VertexAILive] Audio playback error:",e)}},D=async()=>{if(k.current&&(cancelAnimationFrame(k.current),k.current=null),L(),N.current&&(clearTimeout(N.current),N.current=null),f.current){try{f.current.disconnect()}catch(e){console.error("[VertexAILive] Error disconnecting:",e)}f.current=null}if(b.current){try{await b.current.close()}catch(e){console.error("[RecordingContext] Error closing:",e)}b.current=null}if(p.current){try{await p.current.close()}catch(e){console.error("[PlaybackContext] Error closing:",e)}p.current=null}A.current=null,v.current=0,y.current=!1,t(!1),i("idle"),x(Array(32).fill(0))};return(0,r.jsxs)("div",{className:"h-screen flex flex-col bg-gradient-to-b from-[#f8f9fa] via-[#e9ecef] via-30% to-[#0a0a0a] text-[#e5e5e5]",children:[(0,r.jsx)("main",{className:"flex-1 flex items-center justify-center p-4 sm:p-8 overflow-y-auto",children:(0,r.jsx)("div",{className:"w-full max-w-4xl",children:e?(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(o,{audioLevels:h,sessionStatus:s}),(0,r.jsx)("div",{className:"flex gap-4 justify-center",children:(0,r.jsxs)("button",{onClick:D,className:"inline-flex items-center gap-3 px-6 py-3 bg-red-500/10 hover:bg-red-500/20 text-red-400 border border-red-500/30 rounded-xl font-medium transition-all hover:shadow-[0_4px_16px_rgba(239,68,68,0.2)]",children:[(0,r.jsx)("span",{children:"End Conversation"}),(0,r.jsx)("div",{className:"px-3 py-1.5 bg-[#1e1e1e] border border-[#2a2a2a] rounded-lg",children:(0,r.jsx)("span",{className:"text-xs font-mono text-[#e5e5e5] tracking-wider",children:(e=>{let t=Math.floor(e/60);return"".concat(t.toString().padStart(2,"0"),":").concat((e%60).toString().padStart(2,"0"))})(m)})})]})})]}):(0,r.jsxs)("div",{className:"text-center space-y-6 sm:space-y-8",children:[(0,r.jsx)("div",{className:"space-y-4",children:(0,r.jsx)("h1",{className:"text-3xl sm:text-5xl md:text-6xl font-bold tracking-tight bg-gradient-to-r from-[#1a1a1a] via-[#2a2a2a] to-[#3a3a3a] bg-clip-text text-transparent",children:"Voice AI Assistant"})}),(0,r.jsxs)("div",{className:"max-w-md mx-auto space-y-6",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center gap-3",children:[(0,r.jsxs)("div",{className:"inline-flex items-center gap-2 px-6 py-3 bg-white/90 border border-[#dee2e6] rounded-xl pointer-events-none shadow-sm",children:[(0,r.jsx)("span",{className:"text-base",children:"\uD83C\uDF10"}),(0,r.jsx)("span",{className:"text-base text-[#212529] font-medium",children:"Auto-Detect Language"})]}),(0,r.jsx)("p",{className:"text-sm text-[#6c757d]",children:"Speak in the language of your choice"})]}),(0,r.jsx)("button",{onClick:V,disabled:"offline"===d,className:"w-full bg-gradient-to-r from-[#f5f5f5] to-[#e5e5e5] text-[#0a0a0a] rounded-xl px-8 py-4 text-base font-semibold hover:from-[#ffffff] hover:to-[#f5f5f5] hover:shadow-[0_8px_32px_rgba(229,229,229,0.2)] disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 transform hover:-translate-y-0.5 active:translate-y-0",children:"offline"===d?"Service Offline":"Start Conversation"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 max-w-2xl mx-auto mt-8 sm:mt-12",children:[(0,r.jsxs)("div",{className:"bg-white/80 border border-[#dee2e6] rounded-xl p-4 backdrop-blur-sm shadow-sm",children:[(0,r.jsx)("div",{className:"text-2xl mb-2",children:"⚡"}),(0,r.jsx)("h3",{className:"text-sm font-semibold mb-1 text-[#212529]",children:"Low Latency"}),(0,r.jsx)("p",{className:"text-xs text-[#6c757d]",children:"Real-time responses under 1 second"}),(0,r.jsx)("p",{className:"text-xs text-[#6c757d] mt-1",children:"Built with Bun, and Vertex AI Live running on Cloud Run"})]}),(0,r.jsxs)("div",{className:"bg-white/80 border border-[#dee2e6] rounded-xl p-4 backdrop-blur-sm shadow-sm",children:[(0,r.jsx)("div",{className:"text-2xl mb-2",children:"\uD83C\uDF0D"}),(0,r.jsx)("h3",{className:"text-sm font-semibold mb-1 text-[#212529]",children:"Multilingual"}),(0,r.jsxs)("p",{className:"text-xs text-[#6c757d] leading-relaxed",children:[(0,r.jsx)("span",{className:"font-medium text-[#495057]",children:"Indian:"})," Hindi, English, Tamil, Telugu, Marathi, Bengali, Gujarati, Kannada, Malayalam, Punjabi",(0,r.jsx)("br",{}),(0,r.jsx)("span",{className:"font-medium text-[#495057] mt-1 inline-block",children:"International:"})," Spanish, French, German, Chinese, Arabic, Japanese + more"]})]}),(0,r.jsxs)("div",{className:"bg-white/80 border border-[#dee2e6] rounded-xl p-4 backdrop-blur-sm shadow-sm",children:[(0,r.jsx)("div",{className:"text-2xl mb-2",children:"\uD83C\uDFAF"}),(0,r.jsx)("h3",{className:"text-sm font-semibold mb-1 text-[#212529]",children:"Natural"}),(0,r.jsx)("p",{className:"text-xs text-[#6c757d]",children:"Context-aware conversations"}),(0,r.jsx)("p",{className:"text-xs text-[#6c757d] mt-1",children:"Persistent context across sessions with unique user ID"}),(0,r.jsx)("p",{className:"text-xs text-[#6c757d] mt-1",children:"Content ingestion"})]})]})]})})}),(0,r.jsx)("footer",{className:"flex-shrink-0 border-t border-[#2a2a2a] px-6 py-4 text-center bg-[#0f0f0f]/80 backdrop-blur-sm",children:(0,r.jsx)("p",{className:"text-xs text-[#525252]",children:"Built by bots copyright @ Sahamati Labs - Bengaluru • Feminine voice enabled"})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[441,684,358],()=>t(3966)),_N_E=e.O()}]);